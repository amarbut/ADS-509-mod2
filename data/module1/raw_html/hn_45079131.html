<html lang="en" op="item"><head><meta name="referrer" content="origin"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" type="text/css" href="news.css?rdkg5pOPauT7LmsdOtnz"><link rel="icon" href="y18.svg"><link rel="canonical" href="https://news.ycombinator.com/item?id=45079131"><title>Quirks of Common Lisp Types | Hacker News</title></head><body><center><table id="hnmain" border="0" cellpadding="0" cellspacing="0" width="85%" bgcolor="#f6f6ef"><tr><td bgcolor="#ff6600"><table border="0" cellpadding="0" cellspacing="0" width="100%" style="padding:2px"><tr><td style="width:18px;padding-right:4px"><a href="https://news.ycombinator.com"><img src="y18.svg" width="18" height="18" style="border:1px white solid; display:block"></a></td><td style="line-height:12pt; height:10px;"><span class="pagetop"><b class="hnname"><a href="news">Hacker News</a></b><a href="newest">new</a> | <a href="front">past</a> | <a href="newcomments">comments</a> | <a href="ask">ask</a> | <a href="show">show</a> | <a href="jobs">jobs</a> | <a href="submit" rel="nofollow">submit</a></span></td><td style="text-align:right;padding-right:4px;"><span class="pagetop"><a href="login?goto=item%3Fid%3D45079131">login</a></span></td></tr></table></td></tr><tr style='height:10px'/><tr id="bigbox"><td><table class="fatitem" border="0"><tr class="athing submission" id="45079131"><td align="right" valign="top" class="title"><span class="rank"></span></td><td valign="top" class="votelinks"><center><a id='up_45079131' href='vote?id=45079131&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="title"><span class="titleline"><a href="https://www.fosskers.ca/en/blog/cl-type-quirks">Quirks of Common Lisp Types</a><span class="sitebit comhead"> (<a href="from?site=fosskers.ca"><span class="sitestr">fosskers.ca</span></a>)</span></span></td></tr><tr><td colspan="2"></td><td class="subtext"><span class="subline"><span class="score" id="score_45079131">100 points</span> by <a href="user?id=todsacerdoti" class="hnuser">todsacerdoti</a> <span class="age" title="2025-08-31T00:06:42 1756598802"><a href="item?id=45079131">8 hours ago</a></span> <span id="unv_45079131"></span> | <a href="hide?id=45079131&amp;goto=item%3Fid%3D45079131">hide</a> | <a href="https://hn.algolia.com/?query=Quirks%20of%20Common%20Lisp%20Types&type=story&dateRange=all&sort=byDate&storyText=false&prefix&page=0" class="hnpast">past</a> | <a href="fave?id=45079131&amp;auth=b37cf60db60a6cd32e186596a8c11366d738d16a">favorite</a> | <a href="item?id=45079131">18&nbsp;comments</a></span></td></tr><tr><td colspan="2"></td><td><div class="toptext"></div></td></tr><tr style='height:6px'/><tr><td colspan="2"></td><td><form action="comment" method="post"><input type="hidden" name="parent" value="45079131"><input type="hidden" name="goto" value="item?id=45079131"><input type="hidden" name="hmac" value="e9a560199728de9b716f591cde2ded7fd6e167ca"><textarea name="text" rows="8" cols="80" wrap="virtual"></textarea><br><br>
<input type="submit" value="add comment"></form></td></tr></table><br>
<table border="0" class="comment-tree"><tr class="athing comtr" id="45108449"><td><table border="0"><tr><td class="ind" indent="0"><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks"><center><a id='up_45108449' href='vote?id=45108449&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=reikonomusha" class="hnuser">reikonomusha</a> <span class="age" title="2025-09-02T20:18:30 1756844310"><a href="item?id=45108449">1 minute ago</a></span> <span id="unv_45108449"></span><span class="navs"> | <a href="#45103161" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45108449" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">I think this article over-sells the amount of static type checking offered in Common Lisp even by a relatively good implementation like SBCL.<p>SBCL&#x27;s static type checking is merely a courtesy (when it happens), but provides in practice virtually zero guarantees about whether compiling your code actually implies the inexistence of type errors.<p>Typically, the static type errors TFA demonstrates are nullified as soon as anything is abstracted away into a function. To show a trivial example:<p><pre><code>    (+ 2 &quot;2&quot;)
</code></pre>
may error statically but<p><pre><code>    (defun id (x) x)

    (+ 2 (id &quot;2&quot;))
</code></pre>
will not. Furthermore, Common Lisp has no way to label the type of the function ID to constrain its input type to be the same as its output type for all types. That is, there&#x27;s nothing like the Haskell declaration<p><pre><code>    id :: a -&gt; a
    id x = x
</code></pre>
or the C++<p><pre><code>    template &lt;typename A&gt;
    A id(A x) {
        return x;
    }
</code></pre>
In Common Lisp, the closest you can get is either to declare ID to be monomorphic (i.e., just select a <i>single</i> type it can work with), as in<p><pre><code>    (declaim (ftype (function (string) string) id))
</code></pre>
or to say that ID can take <i>anything</i> as input and produce <i>anything</i> (possibly different from the input) as output, as in<p><pre><code>    (declaim (ftype (function (t) t) id))
</code></pre>
Here, T is not a type variable, but instead the name of the &quot;top&quot; type, the supertype of all types.</div><div class="reply"><p><font size="1"><u><a href="reply?id=45108449&amp;goto=item%3Fid%3D45079131%2345108449" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45103161"><td><table border="0"><tr><td class="ind" indent="0"><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks"><center><a id='up_45103161' href='vote?id=45103161&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=alhazraed" class="hnuser">alhazraed</a> <span class="age" title="2025-09-02T13:55:07 1756821307"><a href="item?id=45103161">6 hours ago</a></span> <span id="unv_45103161"></span><span class="navs"> | <a href="#45108449" class="clicky" aria-hidden="true">prev</a> | <a href="#45079540" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45103161" n="3" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">While the post references a link to the &#x27;Type Hierarchy of Strings&#x27;[0], here is the full type tree[1] for Common Lisp.<p>[0]: <a href="https:&#x2F;&#x2F;lispcookbook.github.io&#x2F;cl-cookbook&#x2F;strings.html#string-and-character-types-hierarchy" rel="nofollow">https:&#x2F;&#x2F;lispcookbook.github.io&#x2F;cl-cookbook&#x2F;strings.html#stri...</a><p>[1]: <a href="https:&#x2F;&#x2F;sellout.github.io&#x2F;2012&#x2F;03&#x2F;03&#x2F;common-lisp-type-hierarchy" rel="nofollow">https:&#x2F;&#x2F;sellout.github.io&#x2F;2012&#x2F;03&#x2F;03&#x2F;common-lisp-type-hierar...</a></div><div class="reply"><p><font size="1"><u><a href="reply?id=45103161&amp;goto=item%3Fid%3D45079131%2345103161" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45103711"><td><table border="0"><tr><td class="ind" indent="1"><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks"><center><a id='up_45103711' href='vote?id=45103711&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=perihelions" class="hnuser">perihelions</a> <span class="age" title="2025-09-02T14:37:34 1756823854"><a href="item?id=45103711">5 hours ago</a></span> <span id="unv_45103711"></span><span class="navs"> | <a href="#45103161" class="clicky" aria-hidden="true">parent</a> | <a href="#45103706" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45103711" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">It&#x27;s also easy to draw type graphs like these dynamically: DO-EXTERNAL-SYMBOLS + FIND-CLASS yields you list of types—and CLASS-DIRECT-SUPERCLASSES, from MOP, gives you the edge relations between them. In my personal SLIME setup I render graphs like this through graphviz and into an Emacs buffer.</div><div class="reply"><p><font size="1"><u><a href="reply?id=45103711&amp;goto=item%3Fid%3D45079131%2345103711" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45103706"><td><table border="0"><tr><td class="ind" indent="1"><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks"><center><a id='up_45103706' href='vote?id=45103706&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=selimthegrim" class="hnuser">selimthegrim</a> <span class="age" title="2025-09-02T14:37:14 1756823834"><a href="item?id=45103706">5 hours ago</a></span> <span id="unv_45103706"></span><span class="navs"> | <a href="#45103161" class="clicky" aria-hidden="true">parent</a> | <a href="#45103711" class="clicky" aria-hidden="true">prev</a> | <a href="#45079540" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45103706" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">The type tree is screaming for the Apple Pascal poster treatment</div><div class="reply"><p><font size="1"><u><a href="reply?id=45103706&amp;goto=item%3Fid%3D45079131%2345103706" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45079540"><td><table border="0"><tr><td class="ind" indent="0"><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks"><center><a id='up_45079540' href='vote?id=45079540&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=kazinator" class="hnuser">kazinator</a> <span class="age" title="2025-08-31T01:32:15 1756603935"><a href="item?id=45079540">7 hours ago</a></span> <span id="unv_45079540"></span><span class="navs"> | <a href="#45103161" class="clicky" aria-hidden="true">prev</a> | <a href="#45103578" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45079540" n="3" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">&gt; Note also that this isn&#x27;t a linear hierarchy: in the String example above, simple-array and string are unrelated.<p>Are you sure? If that&#x27;s the case, it would have to be that the object is not a suitable argument to a method parameter of type string.<p>Don&#x27;t guess about whether they&#x27;re considered unrelated in that implementation, use subtypep and typep.<p>If (typep &quot;X&quot; &#x27;string) yields true, then the type of &quot;X&quot;, whatever it is, is related to string.</div><div class="reply"><p><font size="1"><u><a href="reply?id=45079540&amp;goto=item%3Fid%3D45079131%2345079540" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45080138"><td><table border="0"><tr><td class="ind" indent="1"><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks"><center><a id='up_45080138' href='vote?id=45080138&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=kazinator" class="hnuser">kazinator</a> <span class="age" title="2025-08-31T03:31:55 1756611115"><a href="item?id=45080138">7 hours ago</a></span> <span id="unv_45080138"></span><span class="navs"> | <a href="#45079540" class="clicky" aria-hidden="true">parent</a> | <a href="#45103578" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45080138" n="2" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">From article:<p><pre><code>  (list (typep &quot;漣&quot; &#x27;simple-array)
        (typep &quot;漣&quot; &#x27;string)
        (typep &quot;漣&quot; &#x27;vector)
        (typep &quot;漣&quot; &#x27;array)
        (typep &quot;漣&quot; t))

  -&gt; (T T T T T)
</code></pre>
There you go. The type of &quot;漣&quot; is a subtype of <i>string</i>. Since we know that the type is <i>(SIMPLE-ARRAY CHARACTER (1))</i>, it means that this type is a subtype of <i>string</i>. They are therefore related by the supertype-subtype relationship.</div><div class="reply"><p><font size="1"><u><a href="reply?id=45080138&amp;goto=item%3Fid%3D45079131%2345080138" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45103253"><td><table border="0"><tr><td class="ind" indent="2"><img src="s.gif" height="1" width="80"></td><td valign="top" class="votelinks"><center><a id='up_45103253' href='vote?id=45103253&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=colingw" class="hnuser">colingw</a> <span class="age" title="2025-09-02T14:02:50 1756821770"><a href="item?id=45103253">6 hours ago</a></span> <span id="unv_45103253"></span><span class="navs"> | <a href="#45079540" class="clicky" aria-hidden="true">root</a> | <a href="#45080138" class="clicky" aria-hidden="true">parent</a> | <a href="#45103578" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45103253" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">The original intent was that `simple-array`, on its own, is not related to `string`. The referenced type hierarchy makes this clearer: <a href="https:&#x2F;&#x2F;lispcookbook.github.io&#x2F;cl-cookbook&#x2F;strings.html#string-and-character-types-hierarchy" rel="nofollow">https:&#x2F;&#x2F;lispcookbook.github.io&#x2F;cl-cookbook&#x2F;strings.html#stri...</a></div><div class="reply"><p><font size="1"><u><a href="reply?id=45103253&amp;goto=item%3Fid%3D45079131%2345103253" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45103578"><td><table border="0"><tr><td class="ind" indent="0"><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks"><center><a id='up_45103578' href='vote?id=45103578&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=massysett" class="hnuser">massysett</a> <span class="age" title="2025-09-02T14:28:28 1756823308"><a href="item?id=45103578">5 hours ago</a></span> <span id="unv_45103578"></span><span class="navs"> | <a href="#45079540" class="clicky" aria-hidden="true">prev</a> | <a href="#45104887" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45103578" n="3" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">Since the title includes the word &quot;quirks,&quot; the observation I&#x27;ll make here is entirely appropriate: the post oversimplifies this.<p>It says: &quot;So as we can see, at both run-time and compile-time, Common Lisp does typechecking to prevent silly errors.&quot;<p>This is not entirely accurate, as the Common Lisp standard does not require such typechecking.<p>The Common Lisp standard specifies the types of the arguments that a function expects.  It generally does not specify what happens if the function receives arguments of unexpected types.  It explicitly does not specify this: the standard says that if you give a function unexpected types, the consequences are undefined:<p><a href="https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;01_ddc.htm" rel="nofollow">https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;01_dd...</a><p>where &quot;undefined&quot; means that any behavior, from an error message to a harmless failure to a catastrophic failure, can occur:<p><a href="https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;01_db.htm" rel="nofollow">https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;01_db...</a><p>Let&#x27;s take + (the addition function) as an example.  It &quot;might signal&quot; a type error if some argument is not a number:<p><a href="https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;f_pl.htm" rel="nofollow">https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;f_pl....</a><p>where &quot;might signal&quot; means that the result is unpredictable but if the function does signal an error, it will be of the given type:<p><a href="https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;01_db.htm" rel="nofollow">https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;01_db...</a><p>I can understand why the standard is written this way.  Checking the types of arguments takes time.  Sometimes you might not want to check the types for performance reasons.<p>It seems the author is using SBCL.  As a practical matter, SBCL on the default settings will check the types of arguments.  SBCL&#x27;s manual (along with the manual of its predecessor, CMUCL) discusses how to manipulate these settings - the author discusses this, with the DECLARE form.  But Common Lisp does not require this checking, so if you need your types checked, consult your implementation&#x27;s manual.  Indeed, SBCL allows you to change the settings for SPEED and SAFETY to specify how much type-checking you want.<p>All these caveats are also true for structures.  The author says structure types are checked - again, as a practical matter, SBCL will check these unless you tell it not to.  But that&#x27;s not what the standard requires.  Indeed, the standard explicitly states that &quot;It is implementation-dependent whether the type is checked when initializing a slot or when assigning to it.&quot;<p><a href="https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;m_defstr.htm" rel="nofollow">https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;m_def...</a><p>[edit] Relevant part of SBCL manual is here:<p><a href="https:&#x2F;&#x2F;www.sbcl.org&#x2F;manual&#x2F;#Declarations-as-Assertions" rel="nofollow">https:&#x2F;&#x2F;www.sbcl.org&#x2F;manual&#x2F;#Declarations-as-Assertions</a></div><div class="reply"><p><font size="1"><u><a href="reply?id=45103578&amp;goto=item%3Fid%3D45079131%2345103578" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45103861"><td><table border="0"><tr><td class="ind" indent="1"><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks"><center><a id='up_45103861' href='vote?id=45103861&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=colingw" class="hnuser">colingw</a> <span class="age" title="2025-09-02T14:50:07 1756824607"><a href="item?id=45103861">5 hours ago</a></span> <span id="unv_45103861"></span><span class="navs"> | <a href="#45103578" class="clicky" aria-hidden="true">parent</a> | <a href="#45104887" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45103861" n="2" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">Thank you for this. There is occasionally disagreement about what &quot;Common Lisp&quot; even means, and the spec is often cited, but as far as all of my posts, library work, and application work are concerned, Common Lisp means &quot;the current reality of the major compilers as implemented in 2025&quot;. This is a descriptive &#x2F; bottom-up definition, and as an active author of software it is the one I&#x27;m more concerned with. For instance, `:local-nicknames` have been essentially universally implemented among the compilers, despite not being part of the spec. To me, this makes that feature &quot;part of Common Lisp&quot;, especially since basically all CL software written today assumes its availability.<p>You&#x27;re right to point out too that the post is somewhat SBCL-centric - this too reflects a descriptive reality that most new CL software is written with SBCL in mind first. Despite that I&#x27;d always encourage library authors to write as compatible code as possible, since it&#x27;s really not that hard, and other compilers absolutely have value (I use several).</div><div class="reply"><p><font size="1"><u><a href="reply?id=45103861&amp;goto=item%3Fid%3D45079131%2345103861" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45107025"><td><table border="0"><tr><td class="ind" indent="2"><img src="s.gif" height="1" width="80"></td><td valign="top" class="votelinks"><center><a id='up_45107025' href='vote?id=45107025&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=pklausler" class="hnuser">pklausler</a> <span class="age" title="2025-09-02T18:21:27 1756837287"><a href="item?id=45107025">1 hour ago</a></span> <span id="unv_45107025"></span><span class="navs"> | <a href="#45103578" class="clicky" aria-hidden="true">root</a> | <a href="#45103861" class="clicky" aria-hidden="true">parent</a> | <a href="#45104887" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45107025" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">Every programming language has a practical definition: it is the intersection of the sets of features that are accepted by the various relevant production compilers and interpreted identically enough to be portable to all of them.<p>Formal language definitions, standards, and books are great, but you can&#x27;t compile with them.  Abstract language specs that don&#x27;t have reference implementations or conformance test suites are not particularly useful to either implementors or users.</div><div class="reply"><p><font size="1"><u><a href="reply?id=45107025&amp;goto=item%3Fid%3D45079131%2345107025" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45104887"><td><table border="0"><tr><td class="ind" indent="0"><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks"><center><a id='up_45104887' href='vote?id=45104887&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=pfdietz" class="hnuser">pfdietz</a> <span class="age" title="2025-09-02T16:03:15 1756828995"><a href="item?id=45104887">4 hours ago</a></span> <span id="unv_45104887"></span><span class="navs"> | <a href="#45103578" class="clicky" aria-hidden="true">prev</a> | <a href="#45103944" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45104887" n="4" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">The type hierarchy in the standard has an amusing quirk.<p>Arrays can have an element type specified, and this type is &quot;upgraded&quot; to a type that is actually store in the array.   This upgraded type is a supertype of the actual element type.  Upgrading must also preserve subtypes: if T1 is a subtype of T2, then upgrade(T1) must be a subtype of upgrade(T2) (not necessarily a proper subtype, even if T1 != T2).<p>Now, the standard requires that the upgrade of BIT is BIT (that is, (INTEGER 0 1)), and the upgrade of CHARACTER is CHARACTER.   So, what is the upgrade of NIL, the empty type?   It must be a subtype of both BIT and CHARACTER, but the only type with that property is NIL itself.<p>So, the standard requires there must be a specialized array type with element type NIL.  That is, it cannot store any values at all.</div><div class="reply"><p><font size="1"><u><a href="reply?id=45104887&amp;goto=item%3Fid%3D45079131%2345104887" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45107392"><td><table border="0"><tr><td class="ind" indent="1"><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks"><center><a id='up_45107392' href='vote?id=45107392&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=lapsed_lisper" class="hnuser">lapsed_lisper</a> <span class="age" title="2025-09-02T18:51:01 1756839061"><a href="item?id=45107392">1 hour ago</a></span> <span id="unv_45107392"></span><span class="navs"> | <a href="#45104887" class="clicky" aria-hidden="true">parent</a> | <a href="#45106692" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45107392" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">And then, since the type NIL is a subtype of all types, it&#x27;s a subtype of CHARACTER. So because the type STRING is the union of all array types whose element type is a subtype of CHARACTER, an array that can&#x27;t store any values is also a string. Oops.<p>(Also, just for onlookers, in ANSI Common Lisp, but not its ancestors or its sorta-sibling Emacs Lisp, characters are disjoint from integers. That&#x27;s why the intersection of BIT and CHARACTER is empty.)</div><div class="reply"><p><font size="1"><u><a href="reply?id=45107392&amp;goto=item%3Fid%3D45079131%2345107392" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45106692"><td><table border="0"><tr><td class="ind" indent="1"><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks"><center><a id='up_45106692' href='vote?id=45106692&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=munificent" class="hnuser">munificent</a> <span class="age" title="2025-09-02T17:56:57 1756835817"><a href="item?id=45106692">2 hours ago</a></span> <span id="unv_45106692"></span><span class="navs"> | <a href="#45104887" class="clicky" aria-hidden="true">parent</a> | <a href="#45107392" class="clicky" aria-hidden="true">prev</a> | <a href="#45103944" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45106692" n="2" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00"><i>&gt; That is, it cannot store any values at all.</i><p>NIL is a value in Lisp, no? So that means an array with element type NIL should be able to store exactly one value, whose index is NIL.</div><div class="reply"><p><font size="1"><u><a href="reply?id=45106692&amp;goto=item%3Fid%3D45079131%2345106692" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45107304"><td><table border="0"><tr><td class="ind" indent="2"><img src="s.gif" height="1" width="80"></td><td valign="top" class="votelinks"><center><a id='up_45107304' href='vote?id=45107304&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=lapsed_lisper" class="hnuser">lapsed_lisper</a> <span class="age" title="2025-09-02T18:43:17 1756838597"><a href="item?id=45107304">1 hour ago</a></span> <span id="unv_45107304"></span><span class="navs"> | <a href="#45104887" class="clicky" aria-hidden="true">root</a> | <a href="#45106692" class="clicky" aria-hidden="true">parent</a> | <a href="#45103944" class="clicky" aria-hidden="true">next</a> <a class="togg clicky" id="45107304" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">Yes, in Common Lisp, NIL is a value (it&#x27;s a symbol, and by convention also the empty list).<p>But when used as a type specifier, NIL denotes the empty set. So no Lisp object is of that type, and an array with that element type cannot store any object.</div><div class="reply"><p><font size="1"><u><a href="reply?id=45107304&amp;goto=item%3Fid%3D45079131%2345107304" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45103944"><td><table border="0"><tr><td class="ind" indent="0"><img src="s.gif" height="1" width="0"></td><td valign="top" class="votelinks"><center><a id='up_45103944' href='vote?id=45103944&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=shadowgovt" class="hnuser">shadowgovt</a> <span class="age" title="2025-09-02T14:56:34 1756824994"><a href="item?id=45103944">5 hours ago</a></span> <span id="unv_45103944"></span><span class="navs"> | <a href="#45104887" class="clicky" aria-hidden="true">prev</a> <a class="togg clicky" id="45103944" n="4" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">This reminds me of my favorite special form in common-lisp: `the`. <a href="https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;s_the.htm" rel="nofollow">https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;s_the...</a><p>(the fixnum (compute-my-fixnum-value))<p>This specifies that the value in the form in the second argument is of the type specified by the first argument. One might assume that this is what other languages call `assert`, and it can be; your compiler &#x2F; interpreter can be configured to assert if it detects a mismatch between the two.<p>... but the spec actually specifies that if they don&#x27;t match, the behavior is undefined. `the` is also an opportunity for the compiler to throw away some dynamic typechecking logic; essentially, it&#x27;s a chance to paint racing stripes on the implementation so it goes faster at the cost of risking undefined behavior.</div><div class="reply"><p><font size="1"><u><a href="reply?id=45103944&amp;goto=item%3Fid%3D45079131%2345103944" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45104536"><td><table border="0"><tr><td class="ind" indent="1"><img src="s.gif" height="1" width="40"></td><td valign="top" class="votelinks"><center><a id='up_45104536' href='vote?id=45104536&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=dreamcompiler" class="hnuser">dreamcompiler</a> <span class="age" title="2025-09-02T15:39:35 1756827575"><a href="item?id=45104536">4 hours ago</a></span> <span id="unv_45104536"></span><span class="navs"> | <a href="#45103944" class="clicky" aria-hidden="true">parent</a> <a class="togg clicky" id="45104536" n="3" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">Exactly. The primary purpose of type declarations in Common Lisp is to give the compiler a hint that you are taking responsibility for type management so the machine code doesn&#x27;t need to check the type at runtime. But the spec does not <i>require</i> that the compiler obey that hint, and if the compiler <i>does</i> obey the hint the spec says it&#x27;s not the compiler&#x27;s fault if you screw up the type that you took responsibility for.<p>An additional purpose for type declarations is not mentioned in the spec: Static analysis. SBCL goes the extra mile and <i>does</i> do some static analysis with your type declarations, which means it catches many kinds of programmer errors at compile time. Not all CL implementations do this.<p>If you want a Common Lisp that performs thorough static analysis, use Coalton.</div><div class="reply"><p><font size="1"><u><a href="reply?id=45104536&amp;goto=item%3Fid%3D45079131%2345104536" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45104780"><td><table border="0"><tr><td class="ind" indent="2"><img src="s.gif" height="1" width="80"></td><td valign="top" class="votelinks"><center><a id='up_45104780' href='vote?id=45104780&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=shadowgovt" class="hnuser">shadowgovt</a> <span class="age" title="2025-09-02T15:56:05 1756828565"><a href="item?id=45104780">4 hours ago</a></span> <span id="unv_45104780"></span><span class="navs"> | <a href="#45103944" class="clicky" aria-hidden="true">root</a> | <a href="#45104536" class="clicky" aria-hidden="true">parent</a> <a class="togg clicky" id="45104780" n="2" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">This is one of the things I appreciate about Common LISP&#x27;s approach: it allows for undefined behavior, but UB is (mostly, as far as I know, I&#x27;m sure someone will jump in and correct me ;) ) off by default.<p>And I think that&#x27;s the right place for the default to be. C and C++ support UB as well and there are definitely times where you want that for the speed benefits it affords the compiler&#x27;s output, but getting to UB in those languages is as easy as creating a character array and then copying a string that is too long into that character array (gcc will warn you, but about the conversion of a string literal into a char pointer, not about the buffer overrun).<p>And with the C++ spec having a page count exceeding the entire Lord of the Rings trilogy, that&#x27;s a <i>lot</i> of language definition for undefined behavior to live in.</div><div class="reply"><p><font size="1"><u><a href="reply?id=45104780&amp;goto=item%3Fid%3D45079131%2345104780" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr><tr class="athing comtr" id="45105117"><td><table border="0"><tr><td class="ind" indent="3"><img src="s.gif" height="1" width="120"></td><td valign="top" class="votelinks"><center><a id='up_45105117' href='vote?id=45105117&amp;how=up&amp;goto=item%3Fid%3D45079131'><div class='votearrow' title='upvote'></div></a></center></td><td class="default"><div style="margin-top:2px; margin-bottom:-10px;"><span class="comhead"><a href="user?id=lisper" class="hnuser">lisper</a> <span class="age" title="2025-09-02T16:18:38 1756829918"><a href="item?id=45105117">4 hours ago</a></span> <span id="unv_45105117"></span><span class="navs"> | <a href="#45103944" class="clicky" aria-hidden="true">root</a> | <a href="#45104780" class="clicky" aria-hidden="true">parent</a> <a class="togg clicky" id="45105117" n="1" href="javascript:void(0)">[–]</a><span class="onstory"></span></span></span></div><br>
<div class="comment"><div class="commtext c00">&gt; it allows for undefined behavior, but UB is (mostly, as far as I know, I&#x27;m sure someone will jump in and correct me ;) ) off by default.<p>It&#x27;s actually much more sophisticated than that.  See:<p><a href="https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;01_db.htm" rel="nofollow">https:&#x2F;&#x2F;www.lispworks.com&#x2F;documentation&#x2F;HyperSpec&#x2F;Body&#x2F;01_db...</a></div><div class="reply"><p><font size="1"><u><a href="reply?id=45105117&amp;goto=item%3Fid%3D45079131%2345105117" rel="nofollow">reply</a></u></font></div></div></td></tr></table></td></tr></table><br><br>
</td></tr><tr><td><img src="s.gif" height="10" width="0"><table width="100%" cellspacing="0" cellpadding="1"><tr><td bgcolor="#ff6600"></td></tr></table><br>
<center><span class="yclinks"><a href="newsguidelines.html">Guidelines</a> | <a href="newsfaq.html">FAQ</a> | <a href="lists">Lists</a> | <a href="https://github.com/HackerNews/API">API</a> | <a href="security.html">Security</a> | <a href="https://www.ycombinator.com/legal/">Legal</a> | <a href="https://www.ycombinator.com/apply/">Apply to YC</a> | <a href="mailto:hn@ycombinator.com">Contact</a></span><br><br>
<form method="get" action="//hn.algolia.com/">Search: <input type="text" name="q" size="17" autocorrect="off" spellcheck="false" autocapitalize="off" autocomplete="off"></form></center></td></tr></table></center></body><script type="text/javascript" src="hn.js?rdkg5pOPauT7LmsdOtnz"></script></html>